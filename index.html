<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>QR Code Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #667eea;
      --secondary: #764ba2;
      --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--gradient);
      min-height: 100vh;
      padding: 20px 10px;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 25px;
      color: white;
      animation: fadeIn 0.6s ease;
    }

    .header h1 {
      font-size: 2rem;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .header p {
      font-size: 0.95rem;
      opacity: 0.95;
    }

    .credit {
      font-size: 0.85rem;
      margin-top: 10px;
      background: rgba(255,255,255,0.2);
      display: inline-block;
      padding: 8px 20px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      margin-bottom: 15px;
    }

    .input-group {
      margin-bottom: 15px;
    }

    input[type="text"], 
    input[type="url"], 
    input[type="tel"], 
    input[type="email"], 
    select {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      outline: none;
      transition: 0.3s;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      background: var(--gradient);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: 0.3s;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-success { background: linear-gradient(135deg, #4CAF50, #45a049); }
    .btn-danger { background: linear-gradient(135deg, #dc3545, #c82333); }
    .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #333; }

    .qr-display {
      text-align: center;
      padding: 20px 0;
    }

    #qrcode {
      display: inline-block;
      padding: 15px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
      border: 5px solid var(--primary);
    }

    #qrcode canvas {
      display: block !important;
      width: 250px !important;
      height: 250px !important;
    }

    .qr-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50px;
      height: 50px;
      background: white;
      border-radius: 12px;
      padding: 6px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }

    .logo-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }

    .qr-container {
      position: relative;
      display: inline-block;
      margin: 15px 0;
    }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 20px 0;
    }

    .stat-item {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-number {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.8rem;
      color: #666;
      margin-top: 3px;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .hidden {
      display: none !important;
    }

    .section-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #2d3748;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title i {
      color: var(--primary);
    }

    .tabs {
      display: flex;
      border-bottom: 2px solid #e9ecef;
      margin-bottom: 20px;
      gap: 5px;
    }

    .tab {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: 0.3s;
      font-weight: 500;
      color: #666;
      font-size: 0.9rem;
    }

    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .template-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 15px;
    }

    .template-item {
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: 0.3s;
    }

    .template-item:active {
      transform: scale(0.95);
    }

    .template-item.active {
      border-color: var(--primary);
      background: #f0f2ff;
    }

    .template-icon {
      width: 50px;
      height: 50px;
      margin: 0 auto 10px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .template-name {
      font-size: 0.85rem;
      font-weight: 500;
    }

    .color-palette {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .color-option {
      height: 45px;
      border-radius: 10px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: 0.3s;
      position: relative;
    }

    .color-option.active {
      border-color: #333;
    }

    .color-option.active::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .option-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
      font-size: 0.9rem;
    }

    input[type="color"] {
      width: 100%;
      height: 50px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      cursor: pointer;
    }

    .file-upload {
      background: #f8f9fa;
      border: 3px dashed #dee2e6;
      border-radius: 12px;
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: 0.3s;
    }

    .file-upload i {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .file-upload-text {
      font-size: 0.9rem;
      color: #666;
    }

    .logo-preview {
      margin-top: 15px;
      text-align: center;
    }

    .logo-preview img {
      max-width: 100px;
      max-height: 100px;
      border-radius: 10px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    }

    .logo-controls {
      margin-top: 15px;
    }

    input[type="range"] {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 10px;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: var(--gradient);
      border-radius: 50%;
      cursor: pointer;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid #f1f3f4;
      cursor: pointer;
      border-radius: 8px;
      margin-bottom: 8px;
      transition: 0.3s;
    }

    .history-item:active {
      background: #f8f9fa;
    }

    .history-url {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 0.9rem;
    }

    .history-date {
      font-size: 0.75rem;
      color: #888;
      margin-top: 3px;
    }

    .toast-container {
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      z-index: 1000;
    }

    .toast {
      background: white;
      padding: 12px 16px;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: slideDown 0.3s ease;
    }

    .toast.success { border-left: 4px solid #4CAF50; }
    .toast.error { border-left: 4px solid #dc3545; }
    .toast.warning { border-left: 4px solid #ffc107; }
    .toast.info { border-left: 4px solid #17a2b8; }

    .toast i {
      font-size: 1.2rem;
    }

    .toast.success i { color: #4CAF50; }
    .toast.error i { color: #dc3545; }
    .toast.warning i { color: #ffc107; }
    .toast.info i { color: #17a2b8; }

    .about-section {
      text-align: center;
      padding: 20px;
    }

    .about-icon {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 15px;
    }

    .about-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .about-version {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .about-credit {
      background: var(--gradient);
      color: white;
      padding: 12px 25px;
      border-radius: 25px;
      display: inline-block;
      font-weight: 600;
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideDown {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @media (max-width: 400px) {
      .card { padding: 20px; }
      .header h1 { font-size: 1.6rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-qrcode"></i> QR Code Generator</h1>
      <p>Buat QR Code dengan mudah dan cepat</p>
      <div class="credit">âœ¨ Created by Ahmad âœ¨</div>
    </div>

    <!-- Input Card -->
    <div class="card">
      <div class="input-group">
        <input type="url" id="link" placeholder="Masukkan URL atau teks..." />
      </div>
      
      <div class="input-group">
        <select id="qrType" onchange="ubahTipeQR()">
          <option value="url">URL Website</option>
          <option value="text">Teks Biasa</option>
          <option value="email">Email</option>
          <option value="phone">Nomor Telepon</option>
          <option value="whatsapp">WhatsApp</option>
        </select>
      </div>

      <button class="btn" onclick="buatQR()">
        <i class="fas fa-bolt"></i> Generate QR Code
      </button>
    </div>

    <!-- QR Display Card -->
    <div class="card">
      <div class="qr-display">
        <div class="qr-container">
          <div id="qrcode"></div>
          <div class="qr-logo hidden" id="logoContainer">
            <img id="logoImage" class="logo-image" src="" alt="Logo">
          </div>
        </div>
        
        <div class="stats">
          <div class="stat-item">
            <div class="stat-number" id="qrSize">250x250</div>
            <div class="stat-label">Ukuran</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="qrTypeLabel">-</div>
            <div class="stat-label">Tipe</div>
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn btn-success hidden" onclick="downloadQR()" id="downloadBtn">
            <i class="fas fa-download"></i> Download
          </button>
          <button class="btn btn-warning hidden" onclick="resetQR()" id="resetBtn">
            <i class="fas fa-redo"></i> Reset
          </button>
        </div>
      </div>
    </div>

    <!-- Templates Card -->
    <div class="card">
      <div class="section-title">
        <i class="fas fa-palette"></i> Template Cepat
      </div>
      <div class="template-grid">
        <div class="template-item" onclick="applyTemplate('social')">
          <div class="template-icon" style="background: linear-gradient(135deg, #3b5998, #8b9dc3);">
            <i class="fab fa-facebook-f" style="color: white;"></i>
          </div>
          <div class="template-name">Social</div>
        </div>
        <div class="template-item" onclick="applyTemplate('business')">
          <div class="template-icon" style="background: linear-gradient(135deg, #2c3e50, #34495e);">
            <i class="fas fa-briefcase" style="color: white;"></i>
          </div>
          <div class="template-name">Business</div>
        </div>
        <div class="template-item" onclick="applyTemplate('whatsapp')">
          <div class="template-icon" style="background: linear-gradient(135deg, #25D366, #128C7E);">
            <i class="fab fa-whatsapp" style="color: white;"></i>
          </div>
          <div class="template-name">WhatsApp</div>
        </div>
        <div class="template-item" onclick="applyTemplate('creative')">
          <div class="template-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
            <i class="fas fa-paint-brush" style="color: white;"></i>
          </div>
          <div class="template-name">Creative</div>
        </div>
      </div>
    </div>

    <!-- Tabs Card -->
    <div class="card">
      <div class="tabs">
        <div class="tab active" onclick="bukaTab('customize')">
          <i class="fas fa-sliders-h"></i> Kustomisasi
        </div>
        <div class="tab" onclick="bukaTab('history')">
          <i class="fas fa-history"></i> Riwayat
        </div>
        <div class="tab" onclick="bukaTab('settings')">
          <i class="fas fa-cog"></i> Settings
        </div>
      </div>

      <!-- Customize Tab -->
      <div class="tab-content active" id="customize">
        <div class="section-title">
          <i class="fas fa-image"></i> Logo (Opsional)
        </div>
        <div class="file-upload" onclick="document.getElementById('logoUpload').click()">
          <i class="fas fa-cloud-upload-alt"></i>
          <div class="file-upload-text">Klik untuk upload logo</div>
          <div style="color: #999; font-size: 0.8rem; margin-top: 5px;">PNG, JPG (Max 5MB)</div>
        </div>
        <input type="file" id="logoUpload" accept="image/*" class="hidden" onchange="handleLogoUpload(event)">
        
        <div class="logo-preview hidden" id="logoPreview">
          <img id="previewImage" src="" alt="Preview">
        </div>

        <div class="logo-controls hidden" id="logoControls">
          <div class="option-group">
            <label>Ukuran Logo: <span id="logoSizeValue">50</span>px</label>
            <input type="range" id="logoSize" min="30" max="80" value="50" oninput="ubahUkuranLogo()">
          </div>
          <button class="btn btn-danger" onclick="hapusLogo()">
            <i class="fas fa-trash"></i> Hapus Logo
          </button>
        </div>

        <div style="margin-top: 25px;">
          <div class="section-title">
            <i class="fas fa-paint-brush"></i> Warna
          </div>
          
          <div class="option-group">
            <label>Warna QR</label>
            <input type="color" id="qrColor" value="#000000" onchange="ubahWarnaQR()">
          </div>

          <div class="option-group">
            <label>Warna Background</label>
            <input type="color" id="bgColor" value="#ffffff" onchange="ubahWarnaQR()">
          </div>

          <label>Palet Cepat</label>
          <div class="color-palette">
            <div class="color-option active" style="background: #000000;" onclick="pilihWarnaCepat('#000000', '#ffffff')"></div>
            <div class="color-option" style="background: #667eea;" onclick="pilihWarnaCepat('#667eea', '#ffffff')"></div>
            <div class="color-option" style="background: #25D366;" onclick="pilihWarnaCepat('#25D366', '#ffffff')"></div>
            <div class="color-option" style="background: #ff6b6b;" onclick="pilihWarnaCepat('#ff6b6b', '#ffffff')"></div>
            <div class="color-option" style="background: #ffd93d;" onclick="pilihWarnaCepat('#ffd93d', '#000000')"></div>
            <div class="color-option" style="background: #9b59b6;" onclick="pilihWarnaCepat('#9b59b6', '#ffffff')"></div>
          </div>
        </div>
      </div>

      <!-- History Tab -->
      <div class="tab-content" id="history">
        <div class="section-title">
          <i class="fas fa-history"></i> Riwayat QR Code
        </div>
        <div id="historyList">
          <div style="text-align: center; padding: 30px; color: #999;">
            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 10px;"></i>
            <div>Belum ada riwayat</div>
          </div>
        </div>
        <div class="action-buttons" style="margin-top: 15px;">
          <button class="btn btn-danger" onclick="clearHistory()">
            <i class="fas fa-trash"></i> Hapus
          </button>
          <button class="btn" style="background: linear-gradient(135deg, #6c757d, #495057);" onclick="exportHistory()">
            <i class="fas fa-download"></i> Export
          </button>
        </div>
      </div>

      <!-- Settings Tab -->
      <div class="tab-content" id="settings">
        <div class="section-title">
          <i class="fas fa-cog"></i> Pengaturan
        </div>
        
        <div class="option-group">
          <label>Kualitas QR</label>
          <select id="qrQuality">
            <option value="L">Low (7%)</option>
            <option value="M">Medium (15%)</option>
            <option value="Q" selected>Good (25%)</option>
            <option value="H">High (30%)</option>
          </select>
        </div>

        <div class="option-group">
          <label>Format Download</label>
          <select id="downloadFormat">
            <option value="png">PNG</option>
            <option value="jpg">JPG</option>
          </select>
        </div>

        <div class="option-group" style="display: flex; align-items: center; gap: 10px;">
          <input type="checkbox" id="autoSave" checked style="width: 20px; height: 20px;">
          <label style="margin: 0;">Auto-save ke riwayat</label>
        </div>

        <button class="btn btn-warning" onclick="resetSettings()">
          <i class="fas fa-undo"></i> Reset Settings
        </button>

        <div style="margin-top: 30px;">
          <div class="about-section">
            <div class="about-icon">
              <i class="fas fa-qrcode"></i>
            </div>
            <div class="about-title">QR Code Generator</div>
            <div class="about-version">Versi 2.0 - Mobile Optimized</div>
            <div class="about-credit">âœ¨ Created by Ahmad âœ¨</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <script>
    let currentQRCode = null;
    let currentLogo = null;
    let logoSize = 50;
    let qrHistory = JSON.parse(localStorage.getItem('qrHistory')) || [];

    document.addEventListener('DOMContentLoaded', function() {
      loadHistory();
      showNotification('Selamat datang! ðŸ‘‹', 'info');
    });

    function buatQR() {
      const input = document.getElementById('link').value.trim();
      const qrType = document.getElementById('qrType').value;
      
      if (!input) {
        showNotification('Masukkan data terlebih dahulu!', 'warning');
        return;
      }

      let qrData = formatQRContent(input, qrType);
      if (!qrData) return;

      const container = document.getElementById('qrcode');
      container.innerHTML = '';

      const qrColor = document.getElementById('qrColor').value;
      const bgColor = document.getElementById('bgColor').value;
      const qrQuality = document.getElementById('qrQuality').value;

      try {
        currentQRCode = new QRCode(container, {
          text: qrData,
          width: 250,
          height: 250,
          colorDark: qrColor,
          colorLight: bgColor,
          correctLevel: QRCode.CorrectLevel[qrQuality]
        });

        setTimeout(() => {
          document.getElementById('downloadBtn').classList.remove('hidden');
          document.getElementById('resetBtn').classList.remove('hidden');
          updateStats();
          
          if (currentLogo) {
            document.getElementById('logoContainer').classList.remove('hidden');
          }
          
          if (document.getElementById('autoSave').checked) {
            simpanKeHistory();
          }
          
          showNotification('QR Code berhasil dibuat! âœ¨', 'success');
        }, 300);

      } catch (error) {
        showNotification('Gagal membuat QR code', 'error');
      }
    }

    function formatQRContent(content, type) {
      switch(type) {
        case 'url':
          if (!content.startsWith('http://') && !content.startsWith('https://')) {
            content = 'https://' + content;
          }
          return content;
        
        case 'email':
          if (!content.includes('@')) {
            showNotification('Email tidak valid!', 'error');
            return null;
          }
          return `mailto:${content}`;
        
        case 'phone':
          const cleaned = content.replace(/\D/g, '');
          if (cleaned.length < 8) {
            showNotification('Nomor telepon tidak valid!', 'error');
            return null;
          }
          return `tel:${cleaned}`;
        
        case 'whatsapp':
          const phone = content.replace(/\D/g, '');
          if (phone.length < 8) {
            showNotification('Nomor WhatsApp tidak valid!', 'error');
            return null;
          }
          const formattedPhone = phone.startsWith('0') ? '62' + phone.substring(1) : phone;
          return `https://wa.me/${formattedPhone}`;
        
        case 'text':
        default:
          return content;
      }
    }

    function updateStats() {
      document.getElementById('qrSize').textContent = '250x250';
      const typeLabel = document.getElementById('qrType').options[document.getElementById('qrType').selectedIndex].text;
      document.getElementById('qrTypeLabel').textContent = typeLabel;
    }

    function ubahTipeQR() {
      const type = document.getElementById('qrType').value;
      const input = document.getElementById('link');
      
      switch(type) {
        case 'url':
          input.placeholder = 'Masukkan URL (contoh: google.com)';
          break;
        case 'email':
          input.placeholder = 'Masukkan email (contoh: user@email.com)';
          break;
        case 'phone':
          input.placeholder = 'Masukkan nomor telepon';
          break;
        case 'whatsapp':
          input.placeholder = 'Nomor WhatsApp (contoh: 08123456789)';
          break;
        case 'text':
          input.placeholder = 'Masukkan teks bebas...';
          break;
      }
    }

    function handleLogoUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      if (file.size > 5 * 1024 * 1024) {
        showNotification('File terlalu besar! Max 5MB', 'error');
        return;
      }

      if (!file.type.match('image.*')) {
        showNotification('Hanya file gambar yang diperbolehkan', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        currentLogo = e.target.result;
        document.getElementById('previewImage').src = currentLogo;
        document.getElementById('logoImage').src = currentLogo;
        document.getElementById('logoPreview').classList.remove('hidden');
        document.getElementById('logoControls').classList.remove('hidden');
        
        if (currentQRCode) {
          document.getElementById('logoContainer').classList.remove('hidden');
        }
        
        showNotification('Logo berhasil diupload! ðŸ“¸', 'success');
      };
      reader.readAsDataURL(file);
    }

    function ubahUkuranLogo() {
      logoSize = parseInt(document.getElementById('logoSize').value);
      document.getElementById('logoSizeValue').textContent = logoSize;
      const logoContainer = document.getElementById('logoContainer');
      if (logoContainer) {
        logoContainer.style.width = logoSize + 'px';
        logoContainer.style.height = logoSize + 'px';
      }
    }

    function hapusLogo() {
      currentLogo = null;
      document.getElementById('logoUpload').value = '';
      document.getElementById('logoPreview').classList.add('hidden');
      document.getElementById('logoControls').classList.add('hidden');
      document.getElementById('logoContainer').classList.add('hidden');
      showNotification('Logo dihapus', 'info');
    }

    function ubahWarnaQR() {
      if (currentQRCode) {
        buatQR();
      }
    }

    function pilihWarnaCepat(qrColor, bgColor) {
      document.getElementById('qrColor').value = qrColor;
      document.getElementById('bgColor').value = bgColor;
      
      document.querySelectorAll('.color-option').forEach(opt => {
        opt.classList.remove('active');
      });
      event.target.classList.add('active');
      
      if (currentQRCode) {
        buatQR();
      }
    }

    function applyTemplate(templateName) {
      const templates = {
        social: { qrColor: '#3b5998', bgColor: '#ffffff' },
        business: { qrColor: '#2c3e50', bgColor: '#ffffff' },
        whatsapp: { qrColor: '#25D366', bgColor: '#ffffff', type: 'whatsapp' },
        creative: { qrColor: '#9b59b6', bgColor: '#ffffff' }
      };
      
      const template = templates[templateName];
      document.getElementById('qrColor').value = template.qrColor;
      document.getElementById('bgColor').value = template.bgColor;
      
      if (template.type) {
        document.getElementById('qrType').value = template.type;
        ubahTipeQR();
      }
      
      document.querySelectorAll('.template-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.closest('.template-item').classList.add('active');
      
      if (currentQRCode) {
        buatQR();
      }
      
      showNotification(`Template ${templateName} diterapkan! ðŸŽ¨`, 'success');
    }

    function downloadQR() {
      if (!currentQRCode) {
        showNotification('Buat QR Code terlebih dahulu!', 'warning');
        return;
      }

      const canvas = document.querySelector('#qrcode canvas');
      if (!canvas) return;

      try {
        const finalCanvas = document.createElement('canvas');
        const ctx = finalCanvas.getContext('2d');
        const size = 600;

        finalCanvas.width = size;
        finalCanvas.height = size;

        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, size, size);

        const padding = 50;
        const qrSize = size - (padding * 2);
        
        ctx.drawImage(canvas, padding, padding, qrSize, qrSize);

        if (currentLogo) {
          const logoImg = new Image();
          logoImg.onload = function() {
            const logoSizeFinal = logoSize * 2;
            const logoX = (size - logoSizeFinal) / 2;
            const logoY = (size - logoSizeFinal) / 2;
            
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(logoX - 5, logoY - 5, logoSizeFinal + 10, logoSizeFinal + 10);
            ctx.drawImage(logoImg, logoX, logoY, logoSizeFinal, logoSizeFinal);
            
            doDownload(finalCanvas);
          };
          logoImg.src = currentLogo;
        } else {
          doDownload(finalCanvas);
        }
      } catch (error) {
        showNotification('Gagal mendownload QR code', 'error');
      }
    }

    function doDownload(canvas) {
      const format = document.getElementById('downloadFormat').value;
      const link = document.createElement('a');
      const timestamp = new Date().toISOString().slice(0, 10);
      
      link.download = `qrcode-${timestamp}.${format}`;
      link.href = canvas.toDataURL(`image/${format}`, 1.0);
      link.click();
      
      showNotification('QR Code berhasil didownload! ðŸ“¥', 'success');
    }

    function simpanKeHistory() {
      if (!currentQRCode) return;

      const item = {
        id: Date.now(),
        content: document.getElementById('link').value,
        type: document.getElementById('qrType').value,
        timestamp: new Date().toLocaleString('id-ID')
      };

      const isDuplicate = qrHistory.some(h => h.content === item.content);
      
      if (!isDuplicate) {
        qrHistory.unshift(item);
        if (qrHistory.length > 30) {
          qrHistory = qrHistory.slice(0, 30);
        }
        localStorage.setItem('qrHistory', JSON.stringify(qrHistory));
        loadHistory();
      }
    }

    function loadHistory() {
      const historyList = document.getElementById('historyList');
      
      if (qrHistory.length === 0) {
        historyList.innerHTML = `
          <div style="text-align: center; padding: 30px; color: #999;">
            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 10px;"></i>
            <div>Belum ada riwayat</div>
          </div>
        `;
        return;
      }

      historyList.innerHTML = qrHistory.map(item => `
        <div class="history-item" onclick="loadFromHistory(${item.id})">
          <div style="flex: 1;">
            <div class="history-url">${item.content}</div>
            <div class="history-date">${item.timestamp}</div>
          </div>
          <i class="fas fa-chevron-right" style="color: #ccc;"></i>
        </div>
      `).join('');
    }

    function loadFromHistory(id) {
      const item = qrHistory.find(h => h.id === id);
      if (!item) return;

      document.getElementById('link').value = item.content;
      document.getElementById('qrType').value = item.type;
      ubahTipeQR();
      buatQR();
      bukaTab('customize');
      showNotification('Riwayat dimuat! ðŸ“‹', 'success');
    }

    function clearHistory() {
      if (qrHistory.length === 0) {
        showNotification('Tidak ada riwayat untuk dihapus', 'info');
        return;
      }

      if (confirm('Hapus semua riwayat?')) {
        qrHistory = [];
        localStorage.setItem('qrHistory', JSON.stringify(qrHistory));
        loadHistory();
        showNotification('Riwayat dihapus! ðŸ—‘ï¸', 'success');
      }
    }

    function exportHistory() {
      if (qrHistory.length === 0) {
        showNotification('Tidak ada riwayat untuk diexport', 'warning');
        return;
      }

      const dataStr = JSON.stringify(qrHistory, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(dataBlob);
      link.download = `qr-history-${new Date().toISOString().slice(0, 10)}.json`;
      link.click();
      showNotification('Riwayat berhasil diexport! ðŸ“¤', 'success');
    }

    function bukaTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      event.target.classList.add('active');
      document.getElementById(tabName).classList.add('active');
    }

    function resetQR() {
      document.getElementById('qrcode').innerHTML = '';
      document.getElementById('downloadBtn').classList.add('hidden');
      document.getElementById('resetBtn').classList.add('hidden');
      document.getElementById('link').value = '';
      currentQRCode = null;
      showNotification('QR Code direset', 'info');
    }

    function resetSettings() {
      if (confirm('Reset semua pengaturan?')) {
        document.getElementById('qrQuality').value = 'Q';
        document.getElementById('downloadFormat').value = 'png';
        document.getElementById('autoSave').checked = true;
        document.getElementById('qrColor').value = '#000000';
        document.getElementById('bgColor').value = '#ffffff';
        showNotification('Pengaturan direset! ðŸ”„', 'success');
      }
    }

    function showNotification(message, type = 'info') {
      const toastContainer = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-triangle',
        warning: 'fas fa-exclamation-circle',
        info: 'fas fa-info-circle'
      };

      toast.innerHTML = `
        <i class="${icons[type]}"></i>
        <span>${message}</span>
      `;
      
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'slideDown 0.3s ease reverse';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }, 3000);
    }

    document.getElementById('link').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        buatQR();
      }
    });

    document.getElementById('qrQuality').addEventListener('change', function() {
      if (currentQRCode) buatQR();
    });

    document.getElementById('autoSave').addEventListener('change', function() {
      localStorage.setItem('autoSave', this.checked);
    });

    const savedAutoSave = localStorage.getItem('autoSave');
    if (savedAutoSave !== null) {
      document.getElementById('autoSave').checked = savedAutoSave === 'true';
    }

    console.log('QR Code Generator v2.0 Ready! ðŸš€');
  </script>
</body>
</html>
